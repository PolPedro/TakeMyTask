function cov_1dpnx5xlbc(){var path="C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\creat-chat.js";var hash="7a5271ae8b6aeb44b5269fb994093abf144be99b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\creat-chat.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:46}},"1":{start:{line:2,column:0},end:{line:2,column:44}},"2":{start:{line:3,column:41},end:{line:3,column:70}},"3":{start:{line:4,column:75},end:{line:4,column:101}},"4":{start:{line:16,column:0},end:{line:59,column:1}},"5":{start:{line:18,column:4},end:{line:18,column:38}},"6":{start:{line:19,column:4},end:{line:19,column:41}},"7":{start:{line:23,column:4},end:{line:58,column:8}},"8":{start:{line:24,column:21},end:{line:24,column:85}},"9":{start:{line:26,column:23},end:{line:26,column:92}},"10":{start:{line:28,column:8},end:{line:28,column:76}},"11":{start:{line:28,column:30},end:{line:28,column:76}},"12":{start:{line:30,column:21},end:{line:34,column:10}},"13":{start:{line:36,column:24},end:{line:36,column:45}},"14":{start:{line:38,column:8},end:{line:44,column:11}},"15":{start:{line:46,column:8},end:{line:46,column:32}},"16":{start:{line:48,column:8},end:{line:48,column:34}},"17":{start:{line:50,column:8},end:{line:50,column:25}},"18":{start:{line:52,column:8},end:{line:52,column:27}},"19":{start:{line:54,column:8},end:{line:54,column:25}},"20":{start:{line:56,column:8},end:{line:56,column:23}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:16,column:17},end:{line:16,column:18}},loc:{start:{line:16,column:46},end:{line:59,column:1}},line:16},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:12},end:{line:23,column:13}},loc:{start:{line:23,column:24},end:{line:58,column:5}},line:23}},branchMap:{"0":{loc:{start:{line:28,column:8},end:{line:28,column:76}},type:"if",locations:[{start:{line:28,column:8},end:{line:28,column:76}},{start:{line:28,column:8},end:{line:28,column:76}}],line:28},"1":{loc:{start:{line:28,column:12},end:{line:28,column:28}},type:"binary-expr",locations:[{start:{line:28,column:12},end:{line:28,column:17}},{start:{line:28,column:21},end:{line:28,column:28}}],line:28}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7a5271ae8b6aeb44b5269fb994093abf144be99b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1dpnx5xlbc=function(){return actualCoverage;};}return actualCoverage;}cov_1dpnx5xlbc();cov_1dpnx5xlbc().s[0]++;require('takemytask-commons/polyfills/string');cov_1dpnx5xlbc().s[1]++;require('takemytask-commons/polyfills/json');const{errors:{UnexistenceError}}=(cov_1dpnx5xlbc().s[2]++,require('takemytask-commons'));const{models:{Chat,User,Worker,Comments},mongoose:{ObjectId}}=(cov_1dpnx5xlbc().s[3]++,require('takemytask-data'));/**
 * creat a chat with a worker
* @param {string} creatorId user unique id
* @param {string} destinatorId worker unique id 
* 
* @returns {string} chate id
*
* @throws {UnexistenceError} if user or worker dont exists
*/cov_1dpnx5xlbc().s[4]++;module.exports=(creatorId,destinatorId)=>{cov_1dpnx5xlbc().f[0]++;cov_1dpnx5xlbc().s[5]++;String.validate.notVoid(creatorId);cov_1dpnx5xlbc().s[6]++;String.validate.notVoid(destinatorId);//TODO CHECK IF THIS TO USERS ALREADY HAVE A CHAT WITH EACH OTHER
cov_1dpnx5xlbc().s[7]++;return(async()=>{cov_1dpnx5xlbc().f[1]++;const user=(cov_1dpnx5xlbc().s[8]++,await User.findOne({_id:ObjectId(creatorId)},{password:0}));const worker=(cov_1dpnx5xlbc().s[9]++,await Worker.findOne({_id:ObjectId(destinatorId)},{password:0}));cov_1dpnx5xlbc().s[10]++;if((cov_1dpnx5xlbc().b[1][0]++,!user)&&(cov_1dpnx5xlbc().b[1][1]++,!worker)){cov_1dpnx5xlbc().b[0][0]++;cov_1dpnx5xlbc().s[11]++;throw new UnexistenceError(`user dont exists`);}else{cov_1dpnx5xlbc().b[0][1]++;}const chat=(cov_1dpnx5xlbc().s[12]++,await Chat.create({user:ObjectId(creatorId),worker:ObjectId(destinatorId),date:new Date()}));const message=(cov_1dpnx5xlbc().s[13]++,'hello'+worker.name);cov_1dpnx5xlbc().s[14]++;chat.messages.unshift(new Comments({userId:ObjectId(creatorId),name:user.name,surname:user.surname,text:message,date:new Date()}));cov_1dpnx5xlbc().s[15]++;user.chat.push(chat._id);cov_1dpnx5xlbc().s[16]++;worker.chat.push(chat._id);cov_1dpnx5xlbc().s[17]++;await chat.save();cov_1dpnx5xlbc().s[18]++;await worker.save();cov_1dpnx5xlbc().s[19]++;await user.save();cov_1dpnx5xlbc().s[20]++;return chat._id;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0LWNoYXQuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsImVycm9ycyIsIlVuZXhpc3RlbmNlRXJyb3IiLCJtb2RlbHMiLCJDaGF0IiwiVXNlciIsIldvcmtlciIsIkNvbW1lbnRzIiwibW9uZ29vc2UiLCJPYmplY3RJZCIsIm1vZHVsZSIsImV4cG9ydHMiLCJjcmVhdG9ySWQiLCJkZXN0aW5hdG9ySWQiLCJTdHJpbmciLCJ2YWxpZGF0ZSIsIm5vdFZvaWQiLCJ1c2VyIiwiZmluZE9uZSIsIl9pZCIsInBhc3N3b3JkIiwid29ya2VyIiwiY2hhdCIsImNyZWF0ZSIsImRhdGUiLCJEYXRlIiwibWVzc2FnZSIsIm5hbWUiLCJtZXNzYWdlcyIsInVuc2hpZnQiLCJ1c2VySWQiLCJzdXJuYW1lIiwidGV4dCIsInB1c2giLCJzYXZlIl0sIm1hcHBpbmdzIjoibXRGQWVZO21IQWZaQSxPQUFPLENBQUMscUNBQUQsQ0FBUCxDLHdCQUNBQSxPQUFPLENBQUMsbUNBQUQsQ0FBUCxDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLGdCQUFGLENBQVYsMkJBQW1DRixPQUFPLENBQUMsb0JBQUQsQ0FBMUMsQ0FBTixDQUNBLEtBQU0sQ0FBRUcsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsSUFBUixDQUFjQyxNQUFkLENBQXNCQyxRQUF0QixDQUFWLENBQTRDQyxRQUFRLENBQUUsQ0FBQ0MsUUFBRCxDQUF0RCwyQkFBcUVULE9BQU8sQ0FBQyxpQkFBRCxDQUE1RSxDQUFOLENBRUE7Ozs7Ozs7OzBCQVVBVSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsU0FBRCxDQUFZQyxZQUFaLEdBQTZCLGlEQUUxQ0MsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkosU0FBeEIsRUFGMEMsd0JBRzFDRSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSCxZQUF4QixFQUVBO0FBTDBDLHdCQU8xQyxNQUFPLENBQUMsU0FBWSx5QkFDaEIsS0FBTUksQ0FBQUEsSUFBSSwwQkFBRyxLQUFNWixDQUFBQSxJQUFJLENBQUNhLE9BQUwsQ0FBYSxDQUFFQyxHQUFHLENBQUVWLFFBQVEsQ0FBQ0csU0FBRCxDQUFmLENBQWIsQ0FBMkMsQ0FBQ1EsUUFBUSxDQUFFLENBQVgsQ0FBM0MsQ0FBVCxDQUFWLENBRUEsS0FBTUMsQ0FBQUEsTUFBTSwwQkFBRyxLQUFNZixDQUFBQSxNQUFNLENBQUNZLE9BQVAsQ0FBZSxDQUFFQyxHQUFHLENBQUVWLFFBQVEsQ0FBQ0ksWUFBRCxDQUFmLENBQWYsQ0FBZ0QsQ0FBQ08sUUFBUSxDQUFFLENBQVgsQ0FBaEQsQ0FBVCxDQUFaLENBSGdCLHlCQUtoQixHQUFJLDZCQUFDSCxJQUFELCtCQUFTLENBQUNJLE1BQVYsQ0FBSixDQUFzQiwwREFBTSxJQUFJbkIsQ0FBQUEsZ0JBQUosQ0FBc0Isa0JBQXRCLENBQU4sQ0FBOEMsQ0FBcEUsaUNBRUEsS0FBTW9CLENBQUFBLElBQUksMkJBQUcsS0FBTWxCLENBQUFBLElBQUksQ0FBQ21CLE1BQUwsQ0FBWSxDQUMzQk4sSUFBSSxDQUFFUixRQUFRLENBQUNHLFNBQUQsQ0FEYSxDQUUzQlMsTUFBTSxDQUFFWixRQUFRLENBQUNJLFlBQUQsQ0FGVyxDQUczQlcsSUFBSSxDQUFFLEdBQUlDLENBQUFBLElBQUosRUFIcUIsQ0FBWixDQUFULENBQVYsQ0FNQSxLQUFNQyxDQUFBQSxPQUFPLDJCQUFHLFFBQVVMLE1BQU0sQ0FBQ00sSUFBcEIsQ0FBYixDQWJnQix5QkFlaEJMLElBQUksQ0FBQ00sUUFBTCxDQUFjQyxPQUFkLENBQXVCLEdBQUl0QixDQUFBQSxRQUFKLENBQWMsQ0FDakN1QixNQUFNLENBQUVyQixRQUFRLENBQUNHLFNBQUQsQ0FEaUIsQ0FFakNlLElBQUksQ0FBRVYsSUFBSSxDQUFDVSxJQUZzQixDQUdqQ0ksT0FBTyxDQUFFZCxJQUFJLENBQUNjLE9BSG1CLENBSWpDQyxJQUFJLENBQUVOLE9BSjJCLENBS2pDRixJQUFJLENBQUUsR0FBSUMsQ0FBQUEsSUFBSixFQUwyQixDQUFkLENBQXZCLEVBZmdCLHlCQXVCaEJSLElBQUksQ0FBQ0ssSUFBTCxDQUFVVyxJQUFWLENBQWVYLElBQUksQ0FBQ0gsR0FBcEIsRUF2QmdCLHlCQXlCaEJFLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZVyxJQUFaLENBQWlCWCxJQUFJLENBQUNILEdBQXRCLEVBekJnQix5QkEyQmhCLEtBQU1HLENBQUFBLElBQUksQ0FBQ1ksSUFBTCxFQUFOLENBM0JnQix5QkE2QmhCLEtBQU1iLENBQUFBLE1BQU0sQ0FBQ2EsSUFBUCxFQUFOLENBN0JnQix5QkErQmhCLEtBQU1qQixDQUFBQSxJQUFJLENBQUNpQixJQUFMLEVBQU4sQ0EvQmdCLHlCQWlDaEIsTUFBT1osQ0FBQUEsSUFBSSxDQUFDSCxHQUFaLENBRUgsQ0FuQ00sR0FBUCxDQW9DSCxDQTNDRCIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ3Rha2VteXRhc2stY29tbW9ucy9wb2x5ZmlsbHMvc3RyaW5nJylcclxucmVxdWlyZSgndGFrZW15dGFzay1jb21tb25zL3BvbHlmaWxscy9qc29uJylcclxuY29uc3QgeyBlcnJvcnM6IHsgVW5leGlzdGVuY2VFcnJvciB9IH0gPSByZXF1aXJlKCd0YWtlbXl0YXNrLWNvbW1vbnMnKVxyXG5jb25zdCB7IG1vZGVsczogeyBDaGF0LCBVc2VyLCBXb3JrZXIsIENvbW1lbnRzIH0sIG1vbmdvb3NlOiB7T2JqZWN0SWR9IH0gPSByZXF1aXJlKCd0YWtlbXl0YXNrLWRhdGEnKVxyXG5cclxuLyoqXHJcbiAqIGNyZWF0IGEgY2hhdCB3aXRoIGEgd29ya2VyXHJcbiogQHBhcmFtIHtzdHJpbmd9IGNyZWF0b3JJZCB1c2VyIHVuaXF1ZSBpZFxyXG4qIEBwYXJhbSB7c3RyaW5nfSBkZXN0aW5hdG9ySWQgd29ya2VyIHVuaXF1ZSBpZCBcclxuKiBcclxuKiBAcmV0dXJucyB7c3RyaW5nfSBjaGF0ZSBpZFxyXG4qXHJcbiogQHRocm93cyB7VW5leGlzdGVuY2VFcnJvcn0gaWYgdXNlciBvciB3b3JrZXIgZG9udCBleGlzdHNcclxuKi9cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gKGNyZWF0b3JJZCwgZGVzdGluYXRvcklkKSA9PiB7XHJcblxyXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQoY3JlYXRvcklkKVxyXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQoZGVzdGluYXRvcklkKVxyXG5cclxuICAgIC8vVE9ETyBDSEVDSyBJRiBUSElTIFRPIFVTRVJTIEFMUkVBRFkgSEFWRSBBIENIQVQgV0lUSCBFQUNIIE9USEVSXHJcblxyXG4gICAgcmV0dXJuIChhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IF9pZDogT2JqZWN0SWQoY3JlYXRvcklkKSB9LCB7cGFzc3dvcmQ6IDAgfSlcclxuXHJcbiAgICAgICAgY29uc3Qgd29ya2VyID0gYXdhaXQgV29ya2VyLmZpbmRPbmUoeyBfaWQ6IE9iamVjdElkKGRlc3RpbmF0b3JJZCkgfSwge3Bhc3N3b3JkOiAwIH0pXHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKCF1c2VyICYmICF3b3JrZXIpIHRocm93IG5ldyBVbmV4aXN0ZW5jZUVycm9yKGB1c2VyIGRvbnQgZXhpc3RzYClcclxuXHJcbiAgICAgICAgY29uc3QgY2hhdCA9IGF3YWl0IENoYXQuY3JlYXRlKHtcclxuICAgICAgICAgICAgdXNlcjogT2JqZWN0SWQoY3JlYXRvcklkKSwgXHJcbiAgICAgICAgICAgIHdvcmtlcjogT2JqZWN0SWQoZGVzdGluYXRvcklkKSwgXHJcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9ICdoZWxsbycgKyB3b3JrZXIubmFtZVxyXG5cclxuICAgICAgICBjaGF0Lm1lc3NhZ2VzLnVuc2hpZnQoIG5ldyBDb21tZW50cyAoe1xyXG4gICAgICAgICAgICB1c2VySWQ6IE9iamVjdElkKGNyZWF0b3JJZCksXHJcbiAgICAgICAgICAgIG5hbWU6IHVzZXIubmFtZSxcclxuICAgICAgICAgICAgc3VybmFtZTogdXNlci5zdXJuYW1lLFxyXG4gICAgICAgICAgICB0ZXh0OiBtZXNzYWdlLFxyXG4gICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZVxyXG4gICAgICAgIH0pKVxyXG5cclxuICAgICAgICB1c2VyLmNoYXQucHVzaChjaGF0Ll9pZClcclxuXHJcbiAgICAgICAgd29ya2VyLmNoYXQucHVzaChjaGF0Ll9pZClcclxuXHJcbiAgICAgICAgYXdhaXQgY2hhdC5zYXZlKClcclxuXHJcbiAgICAgICAgYXdhaXQgd29ya2VyLnNhdmUoKVxyXG5cclxuICAgICAgICBhd2FpdCB1c2VyLnNhdmUoKVxyXG5cclxuICAgICAgICByZXR1cm4gY2hhdC5faWRcclxuXHJcbiAgICB9KSgpXHJcbn0iXX0=