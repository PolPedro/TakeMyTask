function cov_1dpnx5xlbc(){var path="C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\creat-chat.js";var hash="21b2c66181b69c17a12234920203b304f2dc1a84";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\creat-chat.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:46}},"1":{start:{line:2,column:0},end:{line:2,column:44}},"2":{start:{line:3,column:57},end:{line:3,column:86}},"3":{start:{line:4,column:75},end:{line:4,column:101}},"4":{start:{line:7,column:0},end:{line:48,column:1}},"5":{start:{line:9,column:4},end:{line:9,column:38}},"6":{start:{line:10,column:4},end:{line:10,column:41}},"7":{start:{line:14,column:4},end:{line:47,column:8}},"8":{start:{line:15,column:21},end:{line:15,column:85}},"9":{start:{line:17,column:23},end:{line:17,column:92}},"10":{start:{line:19,column:8},end:{line:19,column:76}},"11":{start:{line:19,column:30},end:{line:19,column:76}},"12":{start:{line:21,column:21},end:{line:25,column:10}},"13":{start:{line:27,column:24},end:{line:27,column:45}},"14":{start:{line:29,column:8},end:{line:33,column:11}},"15":{start:{line:35,column:8},end:{line:35,column:32}},"16":{start:{line:37,column:8},end:{line:37,column:34}},"17":{start:{line:39,column:8},end:{line:39,column:25}},"18":{start:{line:41,column:8},end:{line:41,column:27}},"19":{start:{line:43,column:8},end:{line:43,column:25}},"20":{start:{line:45,column:8},end:{line:45,column:23}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:17},end:{line:7,column:18}},loc:{start:{line:7,column:46},end:{line:48,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:12},end:{line:14,column:13}},loc:{start:{line:14,column:24},end:{line:47,column:5}},line:14}},branchMap:{"0":{loc:{start:{line:19,column:8},end:{line:19,column:76}},type:"if",locations:[{start:{line:19,column:8},end:{line:19,column:76}},{start:{line:19,column:8},end:{line:19,column:76}}],line:19},"1":{loc:{start:{line:19,column:12},end:{line:19,column:28}},type:"binary-expr",locations:[{start:{line:19,column:12},end:{line:19,column:17}},{start:{line:19,column:21},end:{line:19,column:28}}],line:19}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"21b2c66181b69c17a12234920203b304f2dc1a84"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1dpnx5xlbc=function(){return actualCoverage;};}return actualCoverage;}cov_1dpnx5xlbc();cov_1dpnx5xlbc().s[0]++;require('takemytask-commons/polyfills/string');cov_1dpnx5xlbc().s[1]++;require('takemytask-commons/polyfills/json');const{errors:{UnexistenceError,DuplicityError}}=(cov_1dpnx5xlbc().s[2]++,require('takemytask-commons'));const{models:{Chat,User,Worker,Comments},mongoose:{ObjectId}}=(cov_1dpnx5xlbc().s[3]++,require('takemytask-data'));cov_1dpnx5xlbc().s[4]++;module.exports=(creatorId,destinatorId)=>{cov_1dpnx5xlbc().f[0]++;cov_1dpnx5xlbc().s[5]++;String.validate.notVoid(creatorId);cov_1dpnx5xlbc().s[6]++;String.validate.notVoid(destinatorId);//TODO CHECK IF THIS TO USERS ALREADY HAVE A CHAT WITH EACH OTHER
cov_1dpnx5xlbc().s[7]++;return(async()=>{cov_1dpnx5xlbc().f[1]++;const user=(cov_1dpnx5xlbc().s[8]++,await User.findOne({_id:ObjectId(creatorId)},{password:0}));const worker=(cov_1dpnx5xlbc().s[9]++,await Worker.findOne({_id:ObjectId(destinatorId)},{password:0}));cov_1dpnx5xlbc().s[10]++;if((cov_1dpnx5xlbc().b[1][0]++,!user)&&(cov_1dpnx5xlbc().b[1][1]++,!worker)){cov_1dpnx5xlbc().b[0][0]++;cov_1dpnx5xlbc().s[11]++;throw new UnexistenceError(`user dont exists`);}else{cov_1dpnx5xlbc().b[0][1]++;}const chat=(cov_1dpnx5xlbc().s[12]++,await Chat.create({user:ObjectId(creatorId),worker:ObjectId(destinatorId),date:new Date()}));const message=(cov_1dpnx5xlbc().s[13]++,'hello'+worker.name);cov_1dpnx5xlbc().s[14]++;chat.messages.unshift(new Comments({userId:ObjectId(creatorId),text:message,date:new Date()}));cov_1dpnx5xlbc().s[15]++;user.chat.push(chat._id);cov_1dpnx5xlbc().s[16]++;worker.chat.push(chat._id);cov_1dpnx5xlbc().s[17]++;await chat.save();cov_1dpnx5xlbc().s[18]++;await worker.save();cov_1dpnx5xlbc().s[19]++;await user.save();cov_1dpnx5xlbc().s[20]++;return chat._id;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0LWNoYXQuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsImVycm9ycyIsIlVuZXhpc3RlbmNlRXJyb3IiLCJEdXBsaWNpdHlFcnJvciIsIm1vZGVscyIsIkNoYXQiLCJVc2VyIiwiV29ya2VyIiwiQ29tbWVudHMiLCJtb25nb29zZSIsIk9iamVjdElkIiwibW9kdWxlIiwiZXhwb3J0cyIsImNyZWF0b3JJZCIsImRlc3RpbmF0b3JJZCIsIlN0cmluZyIsInZhbGlkYXRlIiwibm90Vm9pZCIsInVzZXIiLCJmaW5kT25lIiwiX2lkIiwicGFzc3dvcmQiLCJ3b3JrZXIiLCJjaGF0IiwiY3JlYXRlIiwiZGF0ZSIsIkRhdGUiLCJtZXNzYWdlIiwibmFtZSIsIm1lc3NhZ2VzIiwidW5zaGlmdCIsInVzZXJJZCIsInRleHQiLCJwdXNoIiwic2F2ZSJdLCJtYXBwaW5ncyI6IjRzRkFlWTttSEFmWkEsT0FBTyxDQUFDLHFDQUFELENBQVAsQyx3QkFDQUEsT0FBTyxDQUFDLG1DQUFELENBQVAsQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxnQkFBRixDQUFvQkMsY0FBcEIsQ0FBViwyQkFBbURILE9BQU8sQ0FBQyxvQkFBRCxDQUExRCxDQUFOLENBQ0EsS0FBTSxDQUFFSSxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFRQyxJQUFSLENBQWNDLE1BQWQsQ0FBc0JDLFFBQXRCLENBQVYsQ0FBNENDLFFBQVEsQ0FBRSxDQUFDQyxRQUFELENBQXRELDJCQUFxRVYsT0FBTyxDQUFDLGlCQUFELENBQTVFLENBQU4sQyx3QkFHQVcsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLFNBQUQsQ0FBWUMsWUFBWixHQUE2QixpREFFMUNDLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JKLFNBQXhCLEVBRjBDLHdCQUcxQ0UsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkgsWUFBeEIsRUFFQTtBQUwwQyx3QkFPMUMsTUFBTyxDQUFDLFNBQVkseUJBQ2hCLEtBQU1JLENBQUFBLElBQUksMEJBQUcsS0FBTVosQ0FBQUEsSUFBSSxDQUFDYSxPQUFMLENBQWEsQ0FBRUMsR0FBRyxDQUFFVixRQUFRLENBQUNHLFNBQUQsQ0FBZixDQUFiLENBQTJDLENBQUNRLFFBQVEsQ0FBRSxDQUFYLENBQTNDLENBQVQsQ0FBVixDQUVBLEtBQU1DLENBQUFBLE1BQU0sMEJBQUcsS0FBTWYsQ0FBQUEsTUFBTSxDQUFDWSxPQUFQLENBQWUsQ0FBRUMsR0FBRyxDQUFFVixRQUFRLENBQUNJLFlBQUQsQ0FBZixDQUFmLENBQWdELENBQUNPLFFBQVEsQ0FBRSxDQUFYLENBQWhELENBQVQsQ0FBWixDQUhnQix5QkFLaEIsR0FBSSw2QkFBQ0gsSUFBRCwrQkFBUyxDQUFDSSxNQUFWLENBQUosQ0FBc0IsMERBQU0sSUFBSXBCLENBQUFBLGdCQUFKLENBQXNCLGtCQUF0QixDQUFOLENBQThDLENBQXBFLGlDQUVBLEtBQU1xQixDQUFBQSxJQUFJLDJCQUFHLEtBQU1sQixDQUFBQSxJQUFJLENBQUNtQixNQUFMLENBQVksQ0FDM0JOLElBQUksQ0FBRVIsUUFBUSxDQUFDRyxTQUFELENBRGEsQ0FFM0JTLE1BQU0sQ0FBRVosUUFBUSxDQUFDSSxZQUFELENBRlcsQ0FHM0JXLElBQUksQ0FBRSxHQUFJQyxDQUFBQSxJQUFKLEVBSHFCLENBQVosQ0FBVCxDQUFWLENBTUEsS0FBTUMsQ0FBQUEsT0FBTywyQkFBRyxRQUFVTCxNQUFNLENBQUNNLElBQXBCLENBQWIsQ0FiZ0IseUJBZWhCTCxJQUFJLENBQUNNLFFBQUwsQ0FBY0MsT0FBZCxDQUF1QixHQUFJdEIsQ0FBQUEsUUFBSixDQUFjLENBQ2pDdUIsTUFBTSxDQUFFckIsUUFBUSxDQUFDRyxTQUFELENBRGlCLENBRWpDbUIsSUFBSSxDQUFFTCxPQUYyQixDQUdqQ0YsSUFBSSxDQUFFLEdBQUlDLENBQUFBLElBQUosRUFIMkIsQ0FBZCxDQUF2QixFQWZnQix5QkFxQmhCUixJQUFJLENBQUNLLElBQUwsQ0FBVVUsSUFBVixDQUFlVixJQUFJLENBQUNILEdBQXBCLEVBckJnQix5QkF1QmhCRSxNQUFNLENBQUNDLElBQVAsQ0FBWVUsSUFBWixDQUFpQlYsSUFBSSxDQUFDSCxHQUF0QixFQXZCZ0IseUJBeUJoQixLQUFNRyxDQUFBQSxJQUFJLENBQUNXLElBQUwsRUFBTixDQXpCZ0IseUJBMkJoQixLQUFNWixDQUFBQSxNQUFNLENBQUNZLElBQVAsRUFBTixDQTNCZ0IseUJBNkJoQixLQUFNaEIsQ0FBQUEsSUFBSSxDQUFDZ0IsSUFBTCxFQUFOLENBN0JnQix5QkErQmhCLE1BQU9YLENBQUFBLElBQUksQ0FBQ0gsR0FBWixDQUVILENBakNNLEdBQVAsQ0FrQ0gsQ0F6Q0QiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCd0YWtlbXl0YXNrLWNvbW1vbnMvcG9seWZpbGxzL3N0cmluZycpXHJcbnJlcXVpcmUoJ3Rha2VteXRhc2stY29tbW9ucy9wb2x5ZmlsbHMvanNvbicpXHJcbmNvbnN0IHsgZXJyb3JzOiB7IFVuZXhpc3RlbmNlRXJyb3IsIER1cGxpY2l0eUVycm9yIH0gfSA9IHJlcXVpcmUoJ3Rha2VteXRhc2stY29tbW9ucycpXHJcbmNvbnN0IHsgbW9kZWxzOiB7IENoYXQsIFVzZXIsIFdvcmtlciwgQ29tbWVudHMgfSwgbW9uZ29vc2U6IHtPYmplY3RJZH0gfSA9IHJlcXVpcmUoJ3Rha2VteXRhc2stZGF0YScpXHJcblxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSAoY3JlYXRvcklkLCBkZXN0aW5hdG9ySWQpID0+IHtcclxuXHJcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChjcmVhdG9ySWQpXHJcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChkZXN0aW5hdG9ySWQpXHJcblxyXG4gICAgLy9UT0RPIENIRUNLIElGIFRISVMgVE8gVVNFUlMgQUxSRUFEWSBIQVZFIEEgQ0hBVCBXSVRIIEVBQ0ggT1RIRVJcclxuXHJcbiAgICByZXR1cm4gKGFzeW5jICgpID0+IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgX2lkOiBPYmplY3RJZChjcmVhdG9ySWQpIH0sIHtwYXNzd29yZDogMCB9KVxyXG5cclxuICAgICAgICBjb25zdCB3b3JrZXIgPSBhd2FpdCBXb3JrZXIuZmluZE9uZSh7IF9pZDogT2JqZWN0SWQoZGVzdGluYXRvcklkKSB9LCB7cGFzc3dvcmQ6IDAgfSlcclxuICAgICAgICBcclxuICAgICAgICBpZiAoIXVzZXIgJiYgIXdvcmtlcikgdGhyb3cgbmV3IFVuZXhpc3RlbmNlRXJyb3IoYHVzZXIgZG9udCBleGlzdHNgKVxyXG5cclxuICAgICAgICBjb25zdCBjaGF0ID0gYXdhaXQgQ2hhdC5jcmVhdGUoe1xyXG4gICAgICAgICAgICB1c2VyOiBPYmplY3RJZChjcmVhdG9ySWQpLCBcclxuICAgICAgICAgICAgd29ya2VyOiBPYmplY3RJZChkZXN0aW5hdG9ySWQpLCBcclxuICAgICAgICAgICAgZGF0ZTogbmV3IERhdGVcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gJ2hlbGxvJyArIHdvcmtlci5uYW1lXHJcblxyXG4gICAgICAgIGNoYXQubWVzc2FnZXMudW5zaGlmdCggbmV3IENvbW1lbnRzICh7XHJcbiAgICAgICAgICAgIHVzZXJJZDogT2JqZWN0SWQoY3JlYXRvcklkKSxcclxuICAgICAgICAgICAgdGV4dDogbWVzc2FnZSxcclxuICAgICAgICAgICAgZGF0ZTogbmV3IERhdGVcclxuICAgICAgICB9KSlcclxuXHJcbiAgICAgICAgdXNlci5jaGF0LnB1c2goY2hhdC5faWQpXHJcblxyXG4gICAgICAgIHdvcmtlci5jaGF0LnB1c2goY2hhdC5faWQpXHJcblxyXG4gICAgICAgIGF3YWl0IGNoYXQuc2F2ZSgpXHJcblxyXG4gICAgICAgIGF3YWl0IHdvcmtlci5zYXZlKClcclxuXHJcbiAgICAgICAgYXdhaXQgdXNlci5zYXZlKClcclxuXHJcbiAgICAgICAgcmV0dXJuIGNoYXQuX2lkXHJcblxyXG4gICAgfSkoKVxyXG59Il19