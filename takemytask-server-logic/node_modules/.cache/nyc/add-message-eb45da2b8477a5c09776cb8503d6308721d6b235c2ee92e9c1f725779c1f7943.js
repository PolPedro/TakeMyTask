function cov_11zeaa7va8(){var path="C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\add-message.js";var hash="cce21990ce349fceeff45b1945b0b6f595cc323b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\add-message.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:46}},"1":{start:{line:2,column:0},end:{line:2,column:44}},"2":{start:{line:3,column:41},end:{line:3,column:70}},"3":{start:{line:4,column:75},end:{line:4,column:101}},"4":{start:{line:18,column:0},end:{line:53,column:1}},"5":{start:{line:20,column:4},end:{line:20,column:35}},"6":{start:{line:21,column:4},end:{line:21,column:35}},"7":{start:{line:22,column:4},end:{line:22,column:36}},"8":{start:{line:24,column:4},end:{line:52,column:8}},"9":{start:{line:30,column:8},end:{line:30,column:76}},"10":{start:{line:32,column:8},end:{line:36,column:9}},"11":{start:{line:33,column:12},end:{line:33,column:82}},"12":{start:{line:35,column:12},end:{line:35,column:87}},"13":{start:{line:35,column:23},end:{line:35,column:87}},"14":{start:{line:38,column:21},end:{line:38,column:66}},"15":{start:{line:40,column:8},end:{line:40,column:83}},"16":{start:{line:40,column:19},end:{line:40,column:83}},"17":{start:{line:42,column:8},end:{line:48,column:11}},"18":{start:{line:50,column:8},end:{line:50,column:25}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:18,column:17},end:{line:18,column:18}},loc:{start:{line:18,column:46},end:{line:53,column:1}},line:18},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:12},end:{line:24,column:13}},loc:{start:{line:24,column:24},end:{line:52,column:5}},line:24}},branchMap:{"0":{loc:{start:{line:32,column:8},end:{line:36,column:9}},type:"if",locations:[{start:{line:32,column:8},end:{line:36,column:9}},{start:{line:32,column:8},end:{line:36,column:9}}],line:32},"1":{loc:{start:{line:35,column:12},end:{line:35,column:87}},type:"if",locations:[{start:{line:35,column:12},end:{line:35,column:87}},{start:{line:35,column:12},end:{line:35,column:87}}],line:35},"2":{loc:{start:{line:40,column:8},end:{line:40,column:83}},type:"if",locations:[{start:{line:40,column:8},end:{line:40,column:83}},{start:{line:40,column:8},end:{line:40,column:83}}],line:40}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"cce21990ce349fceeff45b1945b0b6f595cc323b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_11zeaa7va8=function(){return actualCoverage;};}return actualCoverage;}cov_11zeaa7va8();cov_11zeaa7va8().s[0]++;require('takemytask-commons/polyfills/string');cov_11zeaa7va8().s[1]++;require('takemytask-commons/polyfills/json');const{errors:{UnexistenceError}}=(cov_11zeaa7va8().s[2]++,require('takemytask-commons'));const{models:{Worker,User,Chat,Comments},mongoose:{ObjectId}}=(cov_11zeaa7va8().s[3]++,require('takemytask-data'));/**
 * Adds a message to the chat 
* @param {string} userId userId
 * @param {string} chatId chat unique id
 * @param {string} comment users message
 * 
 * @returns {undefined}
 *
 * @throws {UnexistenceError} if user or worker dont exist
 */cov_11zeaa7va8().s[4]++;module.exports=(userId,chatId,message)=>{cov_11zeaa7va8().f[0]++;cov_11zeaa7va8().s[5]++;String.validate.notVoid(userId);cov_11zeaa7va8().s[6]++;String.validate.notVoid(chatId);cov_11zeaa7va8().s[7]++;String.validate.notVoid(message);cov_11zeaa7va8().s[8]++;return(async()=>{cov_11zeaa7va8().f[1]++;// test if userId exist in users or worker
let user;cov_11zeaa7va8().s[9]++;user=await User.findOne({_id:ObjectId(userId)},{password:0});cov_11zeaa7va8().s[10]++;if(!user){cov_11zeaa7va8().b[0][0]++;cov_11zeaa7va8().s[11]++;user=await Worker.findOne({_id:ObjectId(userId)},{password:0});cov_11zeaa7va8().s[12]++;if(!user){cov_11zeaa7va8().b[1][0]++;cov_11zeaa7va8().s[13]++;throw new UnexistenceError(`user with id ${userId} dont exists`);}else{cov_11zeaa7va8().b[1][1]++;}}else{cov_11zeaa7va8().b[0][1]++;}const chat=(cov_11zeaa7va8().s[14]++,await Chat.findOne({_id:ObjectId(chatId)}));cov_11zeaa7va8().s[15]++;if(!chat){cov_11zeaa7va8().b[2][0]++;cov_11zeaa7va8().s[16]++;throw new UnexistenceError(`chat with id ${chatId} dont exists`);}else{cov_11zeaa7va8().b[2][1]++;}cov_11zeaa7va8().s[17]++;chat.messages.unshift(new Comments({userId:ObjectId(userId),name:user.name,surname:user.surname,text:message,date:new Date()}));cov_11zeaa7va8().s[18]++;await chat.save();})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZC1tZXNzYWdlLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJlcnJvcnMiLCJVbmV4aXN0ZW5jZUVycm9yIiwibW9kZWxzIiwiV29ya2VyIiwiVXNlciIsIkNoYXQiLCJDb21tZW50cyIsIm1vbmdvb3NlIiwiT2JqZWN0SWQiLCJtb2R1bGUiLCJleHBvcnRzIiwidXNlcklkIiwiY2hhdElkIiwibWVzc2FnZSIsIlN0cmluZyIsInZhbGlkYXRlIiwibm90Vm9pZCIsInVzZXIiLCJmaW5kT25lIiwiX2lkIiwicGFzc3dvcmQiLCJjaGF0IiwibWVzc2FnZXMiLCJ1bnNoaWZ0IiwibmFtZSIsInN1cm5hbWUiLCJ0ZXh0IiwiZGF0ZSIsIkRhdGUiLCJzYXZlIl0sIm1hcHBpbmdzIjoicXhGQWVZO21IQWZaQSxPQUFPLENBQUMscUNBQUQsQ0FBUCxDLHdCQUNBQSxPQUFPLENBQUMsbUNBQUQsQ0FBUCxDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLGdCQUFGLENBQVYsMkJBQW1DRixPQUFPLENBQUMsb0JBQUQsQ0FBMUMsQ0FBTixDQUNBLEtBQU0sQ0FBRUcsTUFBTSxDQUFFLENBQUVDLE1BQUYsQ0FBVUMsSUFBVixDQUFnQkMsSUFBaEIsQ0FBc0JDLFFBQXRCLENBQVYsQ0FBNENDLFFBQVEsQ0FBRSxDQUFDQyxRQUFELENBQXRELDJCQUFxRVQsT0FBTyxDQUFDLGlCQUFELENBQTVFLENBQU4sQ0FFQTs7Ozs7Ozs7OzJCQVlBVSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsTUFBRCxDQUFTQyxNQUFULENBQWlCQyxPQUFqQixHQUE2QixpREFFMUNDLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JMLE1BQXhCLEVBRjBDLHdCQUcxQ0csTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkosTUFBeEIsRUFIMEMsd0JBSTFDRSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSCxPQUF4QixFQUowQyx3QkFNMUMsTUFBTyxDQUFDLFNBQVkseUJBRWhCO0FBRUEsR0FBSUksQ0FBQUEsSUFBSixDQUpnQix3QkFNaEJBLElBQUksQ0FBRyxLQUFNYixDQUFBQSxJQUFJLENBQUNjLE9BQUwsQ0FBYSxDQUFFQyxHQUFHLENBQUVYLFFBQVEsQ0FBQ0csTUFBRCxDQUFmLENBQWIsQ0FBd0MsQ0FBQ1MsUUFBUSxDQUFFLENBQVgsQ0FBeEMsQ0FBYixDQU5nQix5QkFRaEIsR0FBSSxDQUFDSCxJQUFMLENBQVUscURBQ05BLElBQUksQ0FBRyxLQUFNZCxDQUFBQSxNQUFNLENBQUNlLE9BQVAsQ0FBZSxDQUFFQyxHQUFHLENBQUVYLFFBQVEsQ0FBQ0csTUFBRCxDQUFmLENBQWYsQ0FBMEMsQ0FBQ1MsUUFBUSxDQUFFLENBQVgsQ0FBMUMsQ0FBYixDQURNLHlCQUdOLEdBQUksQ0FBQ0gsSUFBTCxDQUFXLDBEQUFNLElBQUloQixDQUFBQSxnQkFBSixDQUFzQixnQkFBZVUsTUFBTyxjQUE1QyxDQUFOLENBQWdFLENBQTNFLGlDQUNILENBSkQsaUNBTUEsS0FBTVUsQ0FBQUEsSUFBSSwyQkFBRyxLQUFNaEIsQ0FBQUEsSUFBSSxDQUFDYSxPQUFMLENBQWMsQ0FBQ0MsR0FBRyxDQUFFWCxRQUFRLENBQUNJLE1BQUQsQ0FBZCxDQUFkLENBQVQsQ0FBVixDQWRnQix5QkFnQmhCLEdBQUksQ0FBQ1MsSUFBTCxDQUFXLDBEQUFNLElBQUlwQixDQUFBQSxnQkFBSixDQUFzQixnQkFBZVcsTUFBTyxjQUE1QyxDQUFOLENBQWdFLENBQTNFLGlDQWhCZ0IseUJBa0JoQlMsSUFBSSxDQUFDQyxRQUFMLENBQWNDLE9BQWQsQ0FBdUIsR0FBSWpCLENBQUFBLFFBQUosQ0FBYyxDQUNqQ0ssTUFBTSxDQUFFSCxRQUFRLENBQUNHLE1BQUQsQ0FEaUIsQ0FFakNhLElBQUksQ0FBRVAsSUFBSSxDQUFDTyxJQUZzQixDQUdqQ0MsT0FBTyxDQUFFUixJQUFJLENBQUNRLE9BSG1CLENBSWpDQyxJQUFJLENBQUViLE9BSjJCLENBS2pDYyxJQUFJLENBQUUsR0FBSUMsQ0FBQUEsSUFBSixFQUwyQixDQUFkLENBQXZCLEVBbEJnQix5QkEwQmhCLEtBQU1QLENBQUFBLElBQUksQ0FBQ1EsSUFBTCxFQUFOLENBRUgsQ0E1Qk0sR0FBUCxDQTZCSCxDQW5DRCIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ3Rha2VteXRhc2stY29tbW9ucy9wb2x5ZmlsbHMvc3RyaW5nJylcclxucmVxdWlyZSgndGFrZW15dGFzay1jb21tb25zL3BvbHlmaWxscy9qc29uJylcclxuY29uc3QgeyBlcnJvcnM6IHsgVW5leGlzdGVuY2VFcnJvciB9IH0gPSByZXF1aXJlKCd0YWtlbXl0YXNrLWNvbW1vbnMnKVxyXG5jb25zdCB7IG1vZGVsczogeyBXb3JrZXIsIFVzZXIsIENoYXQsIENvbW1lbnRzIH0sIG1vbmdvb3NlOiB7T2JqZWN0SWR9IH0gPSByZXF1aXJlKCd0YWtlbXl0YXNrLWRhdGEnKVxyXG5cclxuLyoqXHJcbiAqIEFkZHMgYSBtZXNzYWdlIHRvIHRoZSBjaGF0IFxyXG4qIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgdXNlcklkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBjaGF0SWQgY2hhdCB1bmlxdWUgaWRcclxuICogQHBhcmFtIHtzdHJpbmd9IGNvbW1lbnQgdXNlcnMgbWVzc2FnZVxyXG4gKiBcclxuICogQHJldHVybnMge3VuZGVmaW5lZH1cclxuICpcclxuICogQHRocm93cyB7VW5leGlzdGVuY2VFcnJvcn0gaWYgdXNlciBvciB3b3JrZXIgZG9udCBleGlzdFxyXG4gKi9cclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9ICh1c2VySWQsIGNoYXRJZCwgbWVzc2FnZSkgPT4ge1xyXG5cclxuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKHVzZXJJZClcclxuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKGNoYXRJZClcclxuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKG1lc3NhZ2UpIFxyXG5cclxuICAgIHJldHVybiAoYXN5bmMgKCkgPT4ge1xyXG5cclxuICAgICAgICAvLyB0ZXN0IGlmIHVzZXJJZCBleGlzdCBpbiB1c2VycyBvciB3b3JrZXJcclxuXHJcbiAgICAgICAgbGV0IHVzZXJcclxuXHJcbiAgICAgICAgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IF9pZDogT2JqZWN0SWQodXNlcklkKSB9LCB7cGFzc3dvcmQ6IDAgfSlcclxuXHJcbiAgICAgICAgaWYgKCF1c2VyKXtcclxuICAgICAgICAgICAgdXNlciA9IGF3YWl0IFdvcmtlci5maW5kT25lKHsgX2lkOiBPYmplY3RJZCh1c2VySWQpIH0sIHtwYXNzd29yZDogMCB9KVxyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICghdXNlcikgdGhyb3cgbmV3IFVuZXhpc3RlbmNlRXJyb3IoYHVzZXIgd2l0aCBpZCAke3VzZXJJZH0gZG9udCBleGlzdHNgKVxyXG4gICAgICAgIH0gXHJcblxyXG4gICAgICAgIGNvbnN0IGNoYXQgPSBhd2FpdCBDaGF0LmZpbmRPbmUoIHtfaWQ6IE9iamVjdElkKGNoYXRJZCl9IClcclxuXHJcbiAgICAgICAgaWYgKCFjaGF0KSB0aHJvdyBuZXcgVW5leGlzdGVuY2VFcnJvcihgY2hhdCB3aXRoIGlkICR7Y2hhdElkfSBkb250IGV4aXN0c2ApXHJcblxyXG4gICAgICAgIGNoYXQubWVzc2FnZXMudW5zaGlmdCggbmV3IENvbW1lbnRzICh7XHJcbiAgICAgICAgICAgIHVzZXJJZDogT2JqZWN0SWQodXNlcklkKSxcclxuICAgICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxyXG4gICAgICAgICAgICBzdXJuYW1lOiB1c2VyLnN1cm5hbWUsXHJcbiAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlXHJcbiAgICAgICAgfSkpXHJcblxyXG4gICAgICAgIGF3YWl0IGNoYXQuc2F2ZSgpXHJcblxyXG4gICAgfSkoKVxyXG59Il19