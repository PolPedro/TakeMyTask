function cov_fzljtjtgo(){var path="C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\add-rating.js";var hash="fa8283b6bcdbcc156d0150f96952f7ab6e9f409b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\add-rating.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:46}},"1":{start:{line:2,column:0},end:{line:2,column:44}},"2":{start:{line:3,column:41},end:{line:3,column:70}},"3":{start:{line:4,column:60},end:{line:4,column:86}},"4":{start:{line:17,column:0},end:{line:54,column:1}},"5":{start:{line:19,column:4},end:{line:19,column:35}},"6":{start:{line:20,column:4},end:{line:20,column:36}},"7":{start:{line:21,column:4},end:{line:21,column:34}},"8":{start:{line:23,column:4},end:{line:53,column:8}},"9":{start:{line:24,column:21},end:{line:24,column:85}},"10":{start:{line:26,column:8},end:{line:26,column:85}},"11":{start:{line:26,column:19},end:{line:26,column:85}},"12":{start:{line:28,column:22},end:{line:28,column:85}},"13":{start:{line:30,column:8},end:{line:51,column:9}},"14":{start:{line:32,column:12},end:{line:39,column:13}},"15":{start:{line:33,column:16},end:{line:38,column:17}},"16":{start:{line:35,column:20},end:{line:35,column:54}},"17":{start:{line:36,column:20},end:{line:36,column:56}},"18":{start:{line:40,column:12},end:{line:40,column:30}},"19":{start:{line:44,column:12},end:{line:48,column:15}},"20":{start:{line:50,column:12},end:{line:50,column:29}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:17},end:{line:17,column:18}},loc:{start:{line:17,column:45},end:{line:54,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:12},end:{line:23,column:13}},loc:{start:{line:23,column:24},end:{line:53,column:5}},line:23}},branchMap:{"0":{loc:{start:{line:26,column:8},end:{line:26,column:85}},type:"if",locations:[{start:{line:26,column:8},end:{line:26,column:85}},{start:{line:26,column:8},end:{line:26,column:85}}],line:26},"1":{loc:{start:{line:30,column:8},end:{line:51,column:9}},type:"if",locations:[{start:{line:30,column:8},end:{line:51,column:9}},{start:{line:30,column:8},end:{line:51,column:9}}],line:30},"2":{loc:{start:{line:33,column:16},end:{line:38,column:17}},type:"if",locations:[{start:{line:33,column:16},end:{line:38,column:17}},{start:{line:33,column:16},end:{line:38,column:17}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fa8283b6bcdbcc156d0150f96952f7ab6e9f409b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_fzljtjtgo=function(){return actualCoverage;};}return actualCoverage;}cov_fzljtjtgo();cov_fzljtjtgo().s[0]++;require('takemytask-commons/polyfills/string');cov_fzljtjtgo().s[1]++;require('takemytask-commons/polyfills/json');const{errors:{UnexistenceError}}=(cov_fzljtjtgo().s[2]++,require('takemytask-commons'));const{models:{Worker,Rates},mongoose:{ObjectId}}=(cov_fzljtjtgo().s[3]++,require('takemytask-data'));/**
* Adds rating to workers
* @param {string} userId user unique id
* @param {string} ratedId workers unique id
* @param {string} stars number of puntuation given by users 
* 
* @returns {undefined}
*
* @throws {UnexistenceError}  if user or worker dont exist
*/cov_fzljtjtgo().s[4]++;module.exports=(userId,ratedId,stars)=>{cov_fzljtjtgo().f[0]++;cov_fzljtjtgo().s[5]++;String.validate.notVoid(userId);cov_fzljtjtgo().s[6]++;String.validate.notVoid(ratedId);cov_fzljtjtgo().s[7]++;Number.validate.integer(stars);//TODO  stars is between 0 and 5
cov_fzljtjtgo().s[8]++;return(async()=>{cov_fzljtjtgo().f[1]++;const user=(cov_fzljtjtgo().s[9]++,await Worker.findOne({_id:ObjectId(ratedId)},{password:0}));cov_fzljtjtgo().s[10]++;if(!user){cov_fzljtjtgo().b[0][0]++;cov_fzljtjtgo().s[11]++;throw new UnexistenceError(`worker with id ${userId} dont exists`);}else{cov_fzljtjtgo().b[0][1]++;}const rates=(cov_fzljtjtgo().s[12]++,await Worker.findOne({"ratesWorker.userId":ObjectId(userId)}));cov_fzljtjtgo().s[13]++;if(rates){cov_fzljtjtgo().b[1][0]++;cov_fzljtjtgo().s[14]++;for(var i in rates.ratesWorker){cov_fzljtjtgo().s[15]++;if(rates.ratesWorker[i].userId.equals(ObjectId(userId))){cov_fzljtjtgo().b[2][0]++;cov_fzljtjtgo().s[16]++;rates.ratesWorker[i].stars=stars;cov_fzljtjtgo().s[17]++;rates.ratesWorker[i].date=new Date();}else{cov_fzljtjtgo().b[2][1]++;}}cov_fzljtjtgo().s[18]++;await rates.save();}else{cov_fzljtjtgo().b[1][1]++;cov_fzljtjtgo().s[19]++;user.ratesWorker.unshift(new Rates({userId:ObjectId(userId),stars,date:new Date()}));cov_fzljtjtgo().s[20]++;await user.save();}})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZC1yYXRpbmcuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsImVycm9ycyIsIlVuZXhpc3RlbmNlRXJyb3IiLCJtb2RlbHMiLCJXb3JrZXIiLCJSYXRlcyIsIm1vbmdvb3NlIiwiT2JqZWN0SWQiLCJtb2R1bGUiLCJleHBvcnRzIiwidXNlcklkIiwicmF0ZWRJZCIsInN0YXJzIiwiU3RyaW5nIiwidmFsaWRhdGUiLCJub3RWb2lkIiwiTnVtYmVyIiwiaW50ZWdlciIsInVzZXIiLCJmaW5kT25lIiwiX2lkIiwicGFzc3dvcmQiLCJyYXRlcyIsImkiLCJyYXRlc1dvcmtlciIsImVxdWFscyIsImRhdGUiLCJEYXRlIiwic2F2ZSIsInVuc2hpZnQiXSwibWFwcGluZ3MiOiJvNUZBZVk7Z0hBZlpBLE9BQU8sQ0FBQyxxQ0FBRCxDQUFQLEMsdUJBQ0FBLE9BQU8sQ0FBQyxtQ0FBRCxDQUFQLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsZ0JBQUYsQ0FBViwwQkFBbUNGLE9BQU8sQ0FBQyxvQkFBRCxDQUExQyxDQUFOLENBQ0EsS0FBTSxDQUFFRyxNQUFNLENBQUUsQ0FBRUMsTUFBRixDQUFVQyxLQUFWLENBQVYsQ0FBNkJDLFFBQVEsQ0FBRSxDQUFDQyxRQUFELENBQXZDLDBCQUFzRFAsT0FBTyxDQUFDLGlCQUFELENBQTdELENBQU4sQ0FFQTs7Ozs7Ozs7O3lCQVdBUSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsTUFBRCxDQUFTQyxPQUFULENBQWtCQyxLQUFsQixHQUE0QiwrQ0FFekNDLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JMLE1BQXhCLEVBRnlDLHVCQUd6Q0csTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkosT0FBeEIsRUFIeUMsdUJBSXpDSyxNQUFNLENBQUNGLFFBQVAsQ0FBZ0JHLE9BQWhCLENBQXdCTCxLQUF4QixFQUErQjtBQUpVLHVCQU16QyxNQUFPLENBQUMsU0FBWSx3QkFDaEIsS0FBTU0sQ0FBQUEsSUFBSSx5QkFBRyxLQUFNZCxDQUFBQSxNQUFNLENBQUNlLE9BQVAsQ0FBZSxDQUFFQyxHQUFHLENBQUViLFFBQVEsQ0FBQ0ksT0FBRCxDQUFmLENBQWYsQ0FBMkMsQ0FBQ1UsUUFBUSxDQUFFLENBQVgsQ0FBM0MsQ0FBVCxDQUFWLENBRGdCLHdCQUdoQixHQUFJLENBQUNILElBQUwsQ0FBVyx3REFBTSxJQUFJaEIsQ0FBQUEsZ0JBQUosQ0FBc0Isa0JBQWlCUSxNQUFPLGNBQTlDLENBQU4sQ0FBa0UsQ0FBN0UsZ0NBRUEsS0FBTVksQ0FBQUEsS0FBSywwQkFBRyxLQUFNbEIsQ0FBQUEsTUFBTSxDQUFDZSxPQUFQLENBQWUsQ0FBQyxxQkFBc0JaLFFBQVEsQ0FBQ0csTUFBRCxDQUEvQixDQUFmLENBQVQsQ0FBWCxDQUxnQix3QkFPaEIsR0FBR1ksS0FBSCxDQUFTLG1EQUVMLElBQUssR0FBSUMsQ0FBQUEsQ0FBVCxHQUFjRCxDQUFBQSxLQUFLLENBQUNFLFdBQXBCLENBQWdDLHlCQUM1QixHQUFHRixLQUFLLENBQUNFLFdBQU4sQ0FBa0JELENBQWxCLEVBQXFCYixNQUFyQixDQUE0QmUsTUFBNUIsQ0FBbUNsQixRQUFRLENBQUNHLE1BQUQsQ0FBM0MsQ0FBSCxDQUF3RCxtREFFcERZLEtBQUssQ0FBQ0UsV0FBTixDQUFrQkQsQ0FBbEIsRUFBcUJYLEtBQXJCLENBQTZCQSxLQUE3QixDQUZvRCx3QkFHcERVLEtBQUssQ0FBQ0UsV0FBTixDQUFrQkQsQ0FBbEIsRUFBcUJHLElBQXJCLENBQTRCLEdBQUlDLENBQUFBLElBQUosRUFBNUIsQ0FFSCxDQUxELGdDQU1ILENBVEksd0JBVUwsS0FBTUwsQ0FBQUEsS0FBSyxDQUFDTSxJQUFOLEVBQU4sQ0FFSCxDQVpELElBWUssbURBRURWLElBQUksQ0FBQ00sV0FBTCxDQUFpQkssT0FBakIsQ0FBMEIsR0FBSXhCLENBQUFBLEtBQUosQ0FBVyxDQUNqQ0ssTUFBTSxDQUFFSCxRQUFRLENBQUNHLE1BQUQsQ0FEaUIsQ0FFakNFLEtBRmlDLENBR2pDYyxJQUFJLENBQUUsR0FBSUMsQ0FBQUEsSUFBSixFQUgyQixDQUFYLENBQTFCLEVBRkMsd0JBUUQsS0FBTVQsQ0FBQUEsSUFBSSxDQUFDVSxJQUFMLEVBQU4sQ0FDSCxDQUVKLENBOUJNLEdBQVAsQ0ErQkgsQ0FyQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCd0YWtlbXl0YXNrLWNvbW1vbnMvcG9seWZpbGxzL3N0cmluZycpXHJcbnJlcXVpcmUoJ3Rha2VteXRhc2stY29tbW9ucy9wb2x5ZmlsbHMvanNvbicpXHJcbmNvbnN0IHsgZXJyb3JzOiB7IFVuZXhpc3RlbmNlRXJyb3IgfSB9ID0gcmVxdWlyZSgndGFrZW15dGFzay1jb21tb25zJylcclxuY29uc3QgeyBtb2RlbHM6IHsgV29ya2VyLCBSYXRlcyB9LCBtb25nb29zZToge09iamVjdElkfSB9ID0gcmVxdWlyZSgndGFrZW15dGFzay1kYXRhJylcclxuXHJcbi8qKlxyXG4qIEFkZHMgcmF0aW5nIHRvIHdvcmtlcnNcclxuKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIHVzZXIgdW5pcXVlIGlkXHJcbiogQHBhcmFtIHtzdHJpbmd9IHJhdGVkSWQgd29ya2VycyB1bmlxdWUgaWRcclxuKiBAcGFyYW0ge3N0cmluZ30gc3RhcnMgbnVtYmVyIG9mIHB1bnR1YXRpb24gZ2l2ZW4gYnkgdXNlcnMgXHJcbiogXHJcbiogQHJldHVybnMge3VuZGVmaW5lZH1cclxuKlxyXG4qIEB0aHJvd3Mge1VuZXhpc3RlbmNlRXJyb3J9ICBpZiB1c2VyIG9yIHdvcmtlciBkb250IGV4aXN0XHJcbiovXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9ICh1c2VySWQsIHJhdGVkSWQsIHN0YXJzKSA9PiB7XHJcblxyXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQodXNlcklkKVxyXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQocmF0ZWRJZClcclxuICAgIE51bWJlci52YWxpZGF0ZS5pbnRlZ2VyKHN0YXJzKSAvL1RPRE8gIHN0YXJzIGlzIGJldHdlZW4gMCBhbmQgNVxyXG5cclxuICAgIHJldHVybiAoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBXb3JrZXIuZmluZE9uZSh7IF9pZDogT2JqZWN0SWQocmF0ZWRJZCkgfSwge3Bhc3N3b3JkOiAwIH0pXHJcblxyXG4gICAgICAgIGlmICghdXNlcikgdGhyb3cgbmV3IFVuZXhpc3RlbmNlRXJyb3IoYHdvcmtlciB3aXRoIGlkICR7dXNlcklkfSBkb250IGV4aXN0c2ApXHJcblxyXG4gICAgICAgIGNvbnN0IHJhdGVzID0gYXdhaXQgV29ya2VyLmZpbmRPbmUoe1wicmF0ZXNXb3JrZXIudXNlcklkXCI6IE9iamVjdElkKHVzZXJJZCkgfSlcclxuXHJcbiAgICAgICAgaWYocmF0ZXMpe1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByYXRlcy5yYXRlc1dvcmtlcil7XHJcbiAgICAgICAgICAgICAgICBpZihyYXRlcy5yYXRlc1dvcmtlcltpXS51c2VySWQuZXF1YWxzKE9iamVjdElkKHVzZXJJZCkpKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmF0ZXMucmF0ZXNXb3JrZXJbaV0uc3RhcnMgPSBzdGFyc1xyXG4gICAgICAgICAgICAgICAgICAgIHJhdGVzLnJhdGVzV29ya2VyW2ldLmRhdGUgPSBuZXcgRGF0ZVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhd2FpdCByYXRlcy5zYXZlKClcclxuXHJcbiAgICAgICAgfWVsc2V7XHJcblxyXG4gICAgICAgICAgICB1c2VyLnJhdGVzV29ya2VyLnVuc2hpZnQoIG5ldyBSYXRlcyAoeyBcclxuICAgICAgICAgICAgICAgIHVzZXJJZDogT2JqZWN0SWQodXNlcklkKSwgXHJcbiAgICAgICAgICAgICAgICBzdGFycywgXHJcbiAgICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZVxyXG4gICAgICAgICAgICB9KSlcclxuICAgIFxyXG4gICAgICAgICAgICBhd2FpdCB1c2VyLnNhdmUoKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KSgpXHJcbn0iXX0=