function cov_236iad5y2(){var path="C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\add-comment.js";var hash="5455ed8c0ce5d873eb44af622cd1b1d3f9b566d7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\polpe\\bootcamp\\collab\\skylab-bootcamp-202004\\staff\\pol-pedro\\takemytask\\takemytask-server-logic\\add-comment.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:46}},"1":{start:{line:2,column:0},end:{line:2,column:44}},"2":{start:{line:3,column:13},end:{line:3,column:30}},"3":{start:{line:4,column:41},end:{line:4,column:70}},"4":{start:{line:5,column:69},end:{line:5,column:95}},"5":{start:{line:19,column:0},end:{line:50,column:1}},"6":{start:{line:21,column:4},end:{line:21,column:35}},"7":{start:{line:22,column:4},end:{line:22,column:40}},"8":{start:{line:23,column:4},end:{line:23,column:36}},"9":{start:{line:25,column:4},end:{line:49,column:8}},"10":{start:{line:29,column:8},end:{line:29,column:78}},"11":{start:{line:31,column:8},end:{line:31,column:93}},"12":{start:{line:31,column:21},end:{line:31,column:93}},"13":{start:{line:33,column:8},end:{line:33,column:85}},"14":{start:{line:33,column:21},end:{line:33,column:85}},"15":{start:{line:35,column:21},end:{line:35,column:89}},"16":{start:{line:37,column:8},end:{line:37,column:85}},"17":{start:{line:37,column:19},end:{line:37,column:85}},"18":{start:{line:39,column:8},end:{line:45,column:11}},"19":{start:{line:47,column:8},end:{line:47,column:25}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:19,column:17},end:{line:19,column:18}},loc:{start:{line:19,column:51},end:{line:50,column:1}},line:19},"1":{name:"(anonymous_1)",decl:{start:{line:25,column:12},end:{line:25,column:13}},loc:{start:{line:25,column:24},end:{line:49,column:5}},line:25}},branchMap:{"0":{loc:{start:{line:31,column:8},end:{line:31,column:93}},type:"if",locations:[{start:{line:31,column:8},end:{line:31,column:93}},{start:{line:31,column:8},end:{line:31,column:93}}],line:31},"1":{loc:{start:{line:33,column:8},end:{line:33,column:85}},type:"if",locations:[{start:{line:33,column:8},end:{line:33,column:85}},{start:{line:33,column:8},end:{line:33,column:85}}],line:33},"2":{loc:{start:{line:37,column:8},end:{line:37,column:85}},type:"if",locations:[{start:{line:37,column:8},end:{line:37,column:85}},{start:{line:37,column:8},end:{line:37,column:85}}],line:37}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"5455ed8c0ce5d873eb44af622cd1b1d3f9b566d7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_236iad5y2=function(){return actualCoverage;};}return actualCoverage;}cov_236iad5y2();cov_236iad5y2().s[0]++;require('takemytask-commons/polyfills/string');cov_236iad5y2().s[1]++;require('takemytask-commons/polyfills/json');var moment=(cov_236iad5y2().s[2]++,require('moment'));const{errors:{UnexistenceError}}=(cov_236iad5y2().s[3]++,require('takemytask-commons'));const{models:{Worker,Comments,User},mongoose:{ObjectId}}=(cov_236iad5y2().s[4]++,require('takemytask-data'));/**
 * Adds a coment to worker
* @param {string} userId user unique id
 * @param {string} commentedId workers unique id
 * @param {string} comment users comment 
 * 
 * @returns {undefined}
 *
 * @throws {UnexistenceError} if user or worker dont exist
 */cov_236iad5y2().s[5]++;module.exports=(userId,commentedId,comment)=>{cov_236iad5y2().f[0]++;cov_236iad5y2().s[6]++;String.validate.notVoid(userId);cov_236iad5y2().s[7]++;String.validate.notVoid(commentedId);cov_236iad5y2().s[8]++;String.validate.notVoid(comment);cov_236iad5y2().s[9]++;return(async()=>{cov_236iad5y2().f[1]++;let sender;cov_236iad5y2().s[10]++;sender=await User.findOne({_id:ObjectId(userId)},{password:0});cov_236iad5y2().s[11]++;if(!sender){cov_236iad5y2().b[0][0]++;cov_236iad5y2().s[12]++;sender=await Worker.findOne({_id:ObjectId(userId)},{password:0});}else{cov_236iad5y2().b[0][1]++;}cov_236iad5y2().s[13]++;if(!sender){cov_236iad5y2().b[1][0]++;cov_236iad5y2().s[14]++;throw new UnexistenceError(`user with id ${userId} dont exists`);}else{cov_236iad5y2().b[1][1]++;}const user=(cov_236iad5y2().s[15]++,await Worker.findOne({_id:ObjectId(commentedId)},{password:0}));cov_236iad5y2().s[16]++;if(!user){cov_236iad5y2().b[2][0]++;cov_236iad5y2().s[17]++;throw new UnexistenceError(`worker with id ${userId} dont exists`);}else{cov_236iad5y2().b[2][1]++;}cov_236iad5y2().s[18]++;user.comentsWorker.unshift(new Comments({userId:ObjectId(userId),name:sender.name,surname:sender.surname,text:comment,date:new Date()}));cov_236iad5y2().s[19]++;await user.save();})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZC1jb21tZW50LmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJtb21lbnQiLCJlcnJvcnMiLCJVbmV4aXN0ZW5jZUVycm9yIiwibW9kZWxzIiwiV29ya2VyIiwiQ29tbWVudHMiLCJVc2VyIiwibW9uZ29vc2UiLCJPYmplY3RJZCIsIm1vZHVsZSIsImV4cG9ydHMiLCJ1c2VySWQiLCJjb21tZW50ZWRJZCIsImNvbW1lbnQiLCJTdHJpbmciLCJ2YWxpZGF0ZSIsIm5vdFZvaWQiLCJzZW5kZXIiLCJmaW5kT25lIiwiX2lkIiwicGFzc3dvcmQiLCJ1c2VyIiwiY29tZW50c1dvcmtlciIsInVuc2hpZnQiLCJuYW1lIiwic3VybmFtZSIsInRleHQiLCJkYXRlIiwiRGF0ZSIsInNhdmUiXSwibWFwcGluZ3MiOiJpMUZBZVk7Z0hBZlpBLE9BQU8sQ0FBQyxxQ0FBRCxDQUFQLEMsdUJBQ0FBLE9BQU8sQ0FBQyxtQ0FBRCxDQUFQLENBQ0EsR0FBSUMsQ0FBQUEsTUFBTSx5QkFBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFWLENBQ0EsS0FBTSxDQUFFRSxNQUFNLENBQUUsQ0FBRUMsZ0JBQUYsQ0FBViwwQkFBbUNILE9BQU8sQ0FBQyxvQkFBRCxDQUExQyxDQUFOLENBQ0EsS0FBTSxDQUFFSSxNQUFNLENBQUUsQ0FBRUMsTUFBRixDQUFVQyxRQUFWLENBQW9CQyxJQUFwQixDQUFWLENBQXNDQyxRQUFRLENBQUUsQ0FBQ0MsUUFBRCxDQUFoRCwwQkFBK0RULE9BQU8sQ0FBQyxpQkFBRCxDQUF0RSxDQUFOLENBRUE7Ozs7Ozs7OzswQkFZQVUsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLE1BQUQsQ0FBU0MsV0FBVCxDQUFzQkMsT0FBdEIsR0FBa0MsK0NBRS9DQyxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCTCxNQUF4QixFQUYrQyx1QkFHL0NHLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JKLFdBQXhCLEVBSCtDLHVCQUkvQ0UsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkgsT0FBeEIsRUFKK0MsdUJBTS9DLE1BQU8sQ0FBQyxTQUFZLHdCQUVoQixHQUFJSSxDQUFBQSxNQUFKLENBRmdCLHdCQUloQkEsTUFBTSxDQUFHLEtBQU1YLENBQUFBLElBQUksQ0FBQ1ksT0FBTCxDQUFhLENBQUVDLEdBQUcsQ0FBRVgsUUFBUSxDQUFDRyxNQUFELENBQWYsQ0FBYixDQUF3QyxDQUFDUyxRQUFRLENBQUUsQ0FBWCxDQUF4QyxDQUFmLENBSmdCLHdCQU1oQixHQUFHLENBQUNILE1BQUosQ0FBYSxtREFBQUEsTUFBTSxDQUFHLEtBQU1iLENBQUFBLE1BQU0sQ0FBQ2MsT0FBUCxDQUFlLENBQUVDLEdBQUcsQ0FBRVgsUUFBUSxDQUFDRyxNQUFELENBQWYsQ0FBZixDQUEwQyxDQUFDUyxRQUFRLENBQUUsQ0FBWCxDQUExQyxDQUFmLENBQXdFLENBQXJGLGdDQU5nQix3QkFRaEIsR0FBSSxDQUFDSCxNQUFMLENBQWEsd0RBQU0sSUFBSWYsQ0FBQUEsZ0JBQUosQ0FBc0IsZ0JBQWVTLE1BQU8sY0FBNUMsQ0FBTixDQUFnRSxDQUE3RSxnQ0FFQSxLQUFNVSxDQUFBQSxJQUFJLDBCQUFHLEtBQU1qQixDQUFBQSxNQUFNLENBQUNjLE9BQVAsQ0FBZSxDQUFFQyxHQUFHLENBQUVYLFFBQVEsQ0FBQ0ksV0FBRCxDQUFmLENBQWYsQ0FBK0MsQ0FBQ1EsUUFBUSxDQUFFLENBQVgsQ0FBL0MsQ0FBVCxDQUFWLENBVmdCLHdCQVloQixHQUFJLENBQUNDLElBQUwsQ0FBVyx3REFBTSxJQUFJbkIsQ0FBQUEsZ0JBQUosQ0FBc0Isa0JBQWlCUyxNQUFPLGNBQTlDLENBQU4sQ0FBa0UsQ0FBN0UsZ0NBWmdCLHdCQWNoQlUsSUFBSSxDQUFDQyxhQUFMLENBQW1CQyxPQUFuQixDQUE0QixHQUFJbEIsQ0FBQUEsUUFBSixDQUFjLENBQ3RDTSxNQUFNLENBQUVILFFBQVEsQ0FBQ0csTUFBRCxDQURzQixDQUV0Q2EsSUFBSSxDQUFFUCxNQUFNLENBQUNPLElBRnlCLENBR3RDQyxPQUFPLENBQUVSLE1BQU0sQ0FBQ1EsT0FIc0IsQ0FJdENDLElBQUksQ0FBRWIsT0FKZ0MsQ0FLdENjLElBQUksQ0FBRSxHQUFJQyxDQUFBQSxJQUFKLEVBTGdDLENBQWQsQ0FBNUIsRUFkZ0Isd0JBc0JoQixLQUFNUCxDQUFBQSxJQUFJLENBQUNRLElBQUwsRUFBTixDQUVILENBeEJNLEdBQVAsQ0F5QkgsQ0EvQkQiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCd0YWtlbXl0YXNrLWNvbW1vbnMvcG9seWZpbGxzL3N0cmluZycpXHJcbnJlcXVpcmUoJ3Rha2VteXRhc2stY29tbW9ucy9wb2x5ZmlsbHMvanNvbicpXHJcbnZhciBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKVxyXG5jb25zdCB7IGVycm9yczogeyBVbmV4aXN0ZW5jZUVycm9yIH0gfSA9IHJlcXVpcmUoJ3Rha2VteXRhc2stY29tbW9ucycpXHJcbmNvbnN0IHsgbW9kZWxzOiB7IFdvcmtlciwgQ29tbWVudHMsIFVzZXIgfSwgbW9uZ29vc2U6IHtPYmplY3RJZH0gfSA9IHJlcXVpcmUoJ3Rha2VteXRhc2stZGF0YScpXHJcblxyXG4vKipcclxuICogQWRkcyBhIGNvbWVudCB0byB3b3JrZXJcclxuKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIHVzZXIgdW5pcXVlIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb21tZW50ZWRJZCB3b3JrZXJzIHVuaXF1ZSBpZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gY29tbWVudCB1c2VycyBjb21tZW50IFxyXG4gKiBcclxuICogQHJldHVybnMge3VuZGVmaW5lZH1cclxuICpcclxuICogQHRocm93cyB7VW5leGlzdGVuY2VFcnJvcn0gaWYgdXNlciBvciB3b3JrZXIgZG9udCBleGlzdFxyXG4gKi9cclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9ICh1c2VySWQsIGNvbW1lbnRlZElkLCBjb21tZW50KSA9PiB7XHJcblxyXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQodXNlcklkKVxyXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQoY29tbWVudGVkSWQpXHJcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChjb21tZW50KSBcclxuXHJcbiAgICByZXR1cm4gKGFzeW5jICgpID0+IHtcclxuXHJcbiAgICAgICAgbGV0IHNlbmRlclxyXG5cclxuICAgICAgICBzZW5kZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyBfaWQ6IE9iamVjdElkKHVzZXJJZCkgfSwge3Bhc3N3b3JkOiAwIH0pXHJcbiAgICAgICAgIFxyXG4gICAgICAgIGlmKCFzZW5kZXIgKSBzZW5kZXIgPSBhd2FpdCBXb3JrZXIuZmluZE9uZSh7IF9pZDogT2JqZWN0SWQodXNlcklkKSB9LCB7cGFzc3dvcmQ6IDAgfSlcclxuXHJcbiAgICAgICAgaWYgKCFzZW5kZXIpIHRocm93IG5ldyBVbmV4aXN0ZW5jZUVycm9yKGB1c2VyIHdpdGggaWQgJHt1c2VySWR9IGRvbnQgZXhpc3RzYClcclxuXHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFdvcmtlci5maW5kT25lKHsgX2lkOiBPYmplY3RJZChjb21tZW50ZWRJZCkgfSwge3Bhc3N3b3JkOiAwIH0pXHJcblxyXG4gICAgICAgIGlmICghdXNlcikgdGhyb3cgbmV3IFVuZXhpc3RlbmNlRXJyb3IoYHdvcmtlciB3aXRoIGlkICR7dXNlcklkfSBkb250IGV4aXN0c2ApXHJcblxyXG4gICAgICAgIHVzZXIuY29tZW50c1dvcmtlci51bnNoaWZ0KCBuZXcgQ29tbWVudHMgKHsgXHJcbiAgICAgICAgICAgIHVzZXJJZDogT2JqZWN0SWQodXNlcklkKSwgXHJcbiAgICAgICAgICAgIG5hbWU6IHNlbmRlci5uYW1lLFxyXG4gICAgICAgICAgICBzdXJuYW1lOiBzZW5kZXIuc3VybmFtZSxcclxuICAgICAgICAgICAgdGV4dDogY29tbWVudCwgXHJcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKClcclxuICAgICAgICB9KSlcclxuXHJcbiAgICAgICAgYXdhaXQgdXNlci5zYXZlKClcclxuXHJcbiAgICB9KSgpXHJcbn0iXX0=